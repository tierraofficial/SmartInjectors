# SmartInjectors Mod - 使用说明

## 🎯 核心功能

### 直接从快捷栏使用注射器收纳包中的针剂

**问题**: 原版游戏中，注射器收纳包无法直接使用，必须打开背包，从收纳包中取出针剂才能使用。

**解决方案**: 本Mod允许玩家直接从快捷栏打开注射器收纳包，选择针剂立即使用！

## 📖 使用方法

### 第一步: 准备注射器收纳包
1. 在背包中准备一个**注射器收纳包** (TypeID: 882)
2. 往收纳包里放入你需要的针剂 (最多6支)

### 第二步: 设置快捷栏
1. 打开背包
2. 将注射器收纳包拖到快捷栏 (数字键1-6任意位置)

### 第三步: 使用针剂
1. 在游戏中按下对应的数字键 (1-6)
2. 会在快捷栏上方弹出**横向针剂选择UI**，显示收纳包内的所有针剂
3. 用鼠标点击"使用"按钮，或按数字键1-6快速使用对应槽位的针剂
4. 针剂会立即被使用，UI自动关闭

### UI操作说明

| 操作 | 说明 |
|------|------|
| 点击"使用"按钮 | 使用对应槽位的针剂，**UI保持打开** |
| 按数字键1-6 | 快速使用对应槽位的针剂，**UI保持打开** |
| 鼠标右键 | **关闭UI** (避免与ESC暂停冲突) |
| 鼠标拖动标题栏 | 可以移动窗口位置 |

**💡 使用技巧**: UI在使用针剂后会保持打开状态，方便连续使用多个针剂。用完后右键关闭即可。

## 💡 使用技巧

### 1. 快速战斗补给
```
推荐配置:
槽位1: 恢复针 (TypeID: 875) - 紧急回血
槽位2: 止血针 (TypeID: 1247) - 处理流血
槽位3: 黄针 (TypeID: 137) - 常用增益
槽位4-6: 根据任务选择抗性针剂
```

### 2. 键位绑定建议
- 将注射器收纳包绑定到**数字键1** (最容易按到)
- 紧急情况下: 按1打开UI → 按1使用第一支针剂 (恢复针) → UI保持打开
- 如需连续使用多支针剂，继续按数字键即可
- 用完后右键关闭UI

### 3. 槽位管理
- 把最常用的针剂放在**槽位1** (对应UI中的数字键1)
- 按使用频率排序，减少鼠标操作
- 定期检查针剂数量，及时补充

## 🔍 调试功能

Mod还包含游戏物品分析工具:

| 按键 | 功能 |
|------|------|
| F9 | 运行物品分析 (首次) |
| F10 | 重新运行分析 |

分析结果会输出到游戏日志:
```
位置: %AppData%\..\LocalLow\TeamSoda\Escape From Duckov\Player.log
```

## 📋 已知限制

1. **UI使用Unity IMGUI**: 样式比较简单，未来版本会改进

## ✅ 已解决问题

### 问题: UI显示时数字键被游戏快捷栏拦截

**症状**: 当UI显示时，按数字键2-6不会使用针剂，而是触发了快捷栏对应位置的物品

**根本原因**: Unity的`Input.GetKeyDown()`会在同一帧被多个系统检测到。游戏的快捷栏系统和Mod的UI系统同时监听数字键，游戏系统先执行导致按键被"消费"

**解决方案**: 
- 将数字键处理从`Update()`移到`OnGUI()`阶段
- 使用`Event.current`检测按键，并通过`Event.Use()`消费事件
- OnGUI的输入处理优先级高于Update，且可以阻止事件传递
- 这样当UI显示时，数字键不会触发游戏快捷栏

**技术细节**: 
```csharp
// 在 OnGUI() 中
if (Event.current.type == EventType.KeyDown && Event.current.keyCode == KeyCode.Alpha2)
{
    QuickUseSyringeAtSlot(1); // 使用槽位2的针剂
    Event.current.Use();       // 消费事件，防止游戏快捷栏响应
}
```

## 🐛 故障排查

### 问题1: 按数字键没有弹出UI
**检查**:
- 确认注射器收纳包在快捷栏中
- 确认Mod已正确加载 (查看游戏日志)
- 尝试按F10重新分析物品

### 问题2: UI弹出但显示"没有槽位"
**原因**: 注射器收纳包可能损坏或数据异常
**解决**: 尝试重新获取一个注射器收纳包

### 问题3: 点击"使用"后没有效果
**检查**:
- 针剂是否有耐久度
- 角色是否满血/满Buff (某些针剂有使用条件)
- 查看游戏日志的错误信息

### 问题4: UI无法关闭
**解决**: 按鼠标右键关闭

## 📝 日志输出

Mod会在日志中输出详细信息，便于调试:

```
[SmartInjectors] Mod 启动成功!
[SmartInjectors] 注射器收纳包UI已创建
[SmartInjectors] 已订阅角色使用物品事件
[SmartInjectors.UI] 显示注射器收纳包UI
[SmartInjectors.UI] 使用针剂: 恢复针 (TypeID: 875)
```

## 🔄 更新日志

### Version 1.0.0 (2025-10-23)
- ✅ 实现注射器收纳包快捷使用功能
- ✅ 创建针剂选择UI
- ✅ 支持鼠标点击和键盘快捷键
- ✅ 物品分析工具

## 🚀 未来计划

### Phase 2: UI增强
- 显示针剂图标
- 显示针剂效果说明
- 显示针剂数量和耐久度
- 美化UI样式

### Phase 3: 高级功能
- 自动使用针剂 (血量低/Buff过期)
- 针剂使用统计
- Buff状态显示
- 自定义快捷键

---

**祝你游戏愉快！** 🎮

如有问题或建议，请在Mod页面留言。
